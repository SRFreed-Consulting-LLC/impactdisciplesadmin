<dx-toolbar class="content-list__header py-2 px-2 px-2">
  <dxi-item location="after">
    <div *dxTemplate>
      <dx-button class="icon-button manage-button" hint="MANAGE CARDS">
        <div *dxTemplate="let data of 'content'">
          <div class="d-flex">
            <i class="dx-icon-preferences"></i>
          </div>
          <dx-context-menu
            target=".manage-button"
            showEvent="dxclick"
            [position]="{ my: { x: 'center', y: 'top' }, at: 'left bottom' }">
            <dxi-item text="New" icon="add" [onClick]="displayCardAdd"></dxi-item>
          </dx-context-menu>
        </div>
      </dx-button>
    </div>
  </dxi-item>
</dx-toolbar>

<dx-data-grid
  #cardTable
  id="gridContainer"
  [dataSource]="datasource$ | async"
  [height]="'75vh'"
  [showBorders]="true"
  [showColumnLines]="true"
  [showColumnLines]="true"
  [showRowLines]="true"
  [focusedRowEnabled]="true"
  [columnAutoWidth]="true">
    <dxo-load-panel [enabled]="true"></dxo-load-panel>
    <dxo-scrolling mode="virtual"></dxo-scrolling>

    <dxi-column dataField="name"></dxi-column>
    <dxi-column dataField="id"></dxi-column>
    <dxi-column type="buttons" [caption]="'Publish'" [width]="175" [fixed]="true">
        <dxi-button hint="Preview" icon="search" [onClick]="displayCardPreview"></dxi-button>
        <dxi-button hint="Edit" icon="edit" [onClick]="displayCardEdit"></dxi-button>
        <dxi-button hint="Publish" icon="refresh" [onClick]="publishCard"></dxi-button>
        <dxi-button hint="Copy" icon="copy" [onClick]="copyCard"></dxi-button>
        <dxi-button hint="delete" icon="trash" [onClick]="delete"></dxi-button>
    </dxi-column>
</dx-data-grid>

<ng-container *ngIf="editCardVisible$ | async">
  <dx-popup
    [height]="'100%'"
    [width]="'100%'"
    [showTitle]="true"
    title="Card Maker"
    [dragEnabled]="false"
    [hideOnOutsideClick]="true"
    [visible]="editCardVisible$ | async"
    (onHiding)="onEditCancel()">
    <dx-scroll-view [height]="'87%'">
      <app-card-maker [card]="card" [mode]="'edit'"></app-card-maker>
    </dx-scroll-view>
    <div class="add-item-modal__button-group pd-1">
      <dx-button
        text="PREVIEW"
        stylingMode="contained"
        type="normal"
        (onClick)="displayCardEditPreview($event)">
      </dx-button>
      <dx-button
        text="CANCEL"
        stylingMode="contained"
        type="normal"
        (onClick)="onEditCancel()">
      </dx-button>
      <dx-button
        text="SAVE"
        stylingMode="contained"
        type="normal"
        (onClick)="saveChanges()">
      </dx-button>
    </div>
  </dx-popup>
</ng-container>

<ng-container *ngIf="previewCardVisible$ | async">
  <dx-popup
    [height]="'100%'"
    [width]="'100%'"
    [showTitle]="true"
    title="Card Previewer"
    [dragEnabled]="false"
    [hideOnOutsideClick]="true"
    [visible]="previewCardVisible$ | async"
    (onHiding)="onPreviewCancel()">
    <dx-scroll-view [height]="'87%'">
      <app-card-previewer [card]="card" [mode]="'preview'"></app-card-previewer>
    </dx-scroll-view>
    <div class="add-item-modal__button-group pt-1">
      <dx-button
        text="CANCEL"
        stylingMode="contained"
        type="normal"
        (onClick)="onPreviewCancel()">
      </dx-button>
    </div>
  </dx-popup>
</ng-container>
